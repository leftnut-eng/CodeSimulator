<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Robot Code Simulator</title>
  <link rel="stylesheet" href="style.css">
  <!-- https://github.com/google/blockly -->
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://unpkg.com/blockly/python.min.js"></script>
</head>

<body>
  <h2>Robot Code Simulator</h2>
  <button onclick="generateCode()">Run Code</button>
  <pre id="pythonOutput"></pre>
  <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>

  <xml id="toolbox" style="display: none">
    <category name="Movement">
      <block type="move_forward"></block>
      <block type="turn_left"></block>
      <block type="turn_right"></block>
    </category>
  </xml>

  <script>
    const workspace = Blockly.inject('blocklyDiv', {
      toolbox: document.getElementById('toolbox')
    });

    Blockly.defineBlocksWithJsonArray([
      {
        "type": "move_forward",
        "message0": "move forward %1 steps",
        "args0": [{ "type": "field_number", "name": "STEPS", "value": 10 }],
        "previousStatement": null,
        "nextStatement": null,
        "colour": 160
      },
      {
        "type": "turn_left",
        "message0": "turn left %1 degrees",
        "args0": [{ "type": "field_angle", "name": "DEGREES", "angle": 90 }],
        "previousStatement": null,
        "nextStatement": null,
        "colour": 210
      },
      {
        "type": "turn_right",
        "message0": "turn right %1 degrees",
        "args0": [{ "type": "field_angle", "name": "DEGREES", "angle": 90 }],
        "previousStatement": null,
        "nextStatement": null,
        "colour": 210
      }
    ]);

    Blockly.Python['move_forward'] = function (block) {
      const steps = block.getFieldValue('STEPS');
      return `robot.move_forward(${steps})\n`;
    };

    Blockly.Python['turn_left'] = function (block) {
      const degrees = block.getFieldValue('DEGREES');
      return `robot.turn_left(${degrees})\n`;
    };

    Blockly.Python['turn_right'] = function (block) {
      const degrees = block.getFieldValue('DEGREES');
      return `robot.turn_right(${degrees})\n`;
    };

    function generateCode() {
      const code = Blockly.Python.workspaceToCode(workspace);
      document.getElementById('pythonOutput').textContent = code;
    }
  </script>
</body>

</html>